<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reminder</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="style.css">
    <style>

    </style>
</head>

<body>
    <div class="container">
        <div class="ask">
            <h1>Напоминалка</h1>
            <div class="calendar" id="calendar">
                <!-- Calendar will be generated here -->
            </div>
            <form id="reminder-form" class="reminder-form">
                <input type="text" id="event-input" placeholder="Event">
                <input type="date" class="hidden" id="date-input">
                <input type="time" id="time-input">
                <button type="submit">Добавить напоминание</button>
            </form>
        </div>
        <table class="reminder-table">
            <thead>
                <tr>
                    <th>Дата</th>
                    <th>Время</th>
                    <th>Событие</th>
                    <th>Действия</th>
                </tr>
            </thead>
            <tbody id="reminder-list">
                <!-- List of reminders will be displayed here -->
            </tbody>
        </table>
    </div>

    <script>
         class Reminder {
            constructor(event, date, time) {
                this.event = event;
                this.date = date;
                this.time = time;
            }
            startReminderTimer() {
                const targetDateTime = new Date(`${this.date} ${this.time}`);
                const currentTime = new Date();

                const timeRemaining = targetDateTime.getTime() - currentTime.getTime() ;

                if (timeRemaining > 0) {
                    setTimeout(() => {
                        Sound.playReminderSound();
                        calendar.removeReminder(this); // Удаление напоминания после воспроизведения звукового сигнала
                        displayReminders(); // Обновление отображения списка напоминаний
                    }, timeRemaining);
                }
            }


          static isValidDate(date, time) {
            const selectedDateTime = new Date(`${date} ${time}`);
            return selectedDateTime >  new Date();
         }

         
            getEvent() {
                return this.event;
            }
            getDate() {
                return this.date;
            }
            getTime() {
                return this.time;
            }
        }

        class Calendar {
            constructor() {
                this.reminders = [];
                this.currentMonth = new Date().getMonth();
                this.currentYear = new Date().getFullYear();
            }

            addReminder(reminder) {
                if (!this.hasDuplicateReminder(reminder)) {
                    this.reminders.push(reminder);
                }
            }

            removeReminder(reminder) {
                this.reminders = this.reminders.filter(
                    (r) => r.event !== reminder.event && r.date !== reminder.date
                );
            }

            hasDuplicateReminder(reminder) {
                return this.reminders.some(
                    (r) => r.event === reminder.event && r.date === reminder.date
                );
            }
        }

        class Sound {
            static playReminderSound() {
                const audio = new Audio('sound.mp3');
                alert('fff');
                audio.play();
            }
        }

        const calendar = new Calendar();


        generateCalendar(calendar.currentYear, calendar.currentMonth);
        // Function to generate the calendar
        function generateCalendar(year, month) {
            const calendarContainer = document.getElementById('calendar');
            calendarContainer.innerHTML = '';


           const days = ['ПН', 'ВТ', 'СР',  'ЧТ', 'ПТ', 'СБ', 'ВС'];
            for (let i = 1; i <= 7; i++) {
                const calendarCell = document.createElement('div');
                calendarCell.className = 'calendar-cell-date';
                calendarCell.textContent = days[i-1];
                calendarContainer.appendChild(calendarCell); 
            }



            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const firstDayOfMonth = new Date(year, month, 1).getDay();
          
            for (let i = 1; i < firstDayOfMonth; i++) {
              const emptyCell = document.createElement('div');
              emptyCell.className = 'calendar-cell';
              calendarContainer.appendChild(emptyCell);
            }

           


            for (let day = 1; day <= daysInMonth; day++) {
              const calendarCell = document.createElement('div');
              calendarCell.className = 'calendar-cell';
              calendarCell.textContent = day;
          
              // Проверка, является ли дата прошедшей
              const currentDate = new Date();
              const currentYear = currentDate.getFullYear();
              const currentMonth = currentDate.getMonth();
              if (currentYear === year && currentMonth === month && day >= currentDate.getDate()) {
                calendarCell.classList.add('usual');
              } else {
                calendarCell.classList.add('inactive');
              }
          
              // Check if the day has reminders and apply the pink background
              const hasReminder = calendar.reminders.some(
                (reminder) => reminder.getDate() === `${year}-${month + 1}-${day}`
              );
              if (hasReminder) {
                calendarCell.style.background = '#000';
              }
          
              calendarCell.addEventListener('click', () => {
                // Удалить класс "active" у всех ячеек
                const cells = document.getElementsByClassName('calendar-cell');
                for (let i = 0; i < cells.length; i++) {
                  cells[i].classList.remove('active');
                }
          
                // Добавить класс "active" к выбранной ячейке
                calendarCell.classList.add('active');
          
                // Обработка остальной логики
                const selectedDate = new Date(year, month, day+1);
                document.getElementById('date-input').valueAsDate = selectedDate;
              });
          
              calendarContainer.appendChild(calendarCell);
            }
          }

        document.getElementById('reminder-form').addEventListener('submit', (e) => {
            e.preventDefault();

            const eventInput = document.getElementById('event-input');
            const dateInput = document.getElementById('date-input');
            const timeInput = document.getElementById('time-input');

            const event = eventInput.value.trim();
            const date = dateInput.value.trim();
            const time = timeInput.value.trim();

            if (!event || !date || !time) {
                alert('Заполните все поля');
                return;
            }

            if (!Reminder.isValidDate(date, time)) {
                alert('Пожалуйста, выберите дату в будующем');
                return;
            }

            const reminder = new Reminder(event, date, time);
            calendar.addReminder(reminder);
            displayReminders();

            eventInput.value = '';
            dateInput.value = '';
            timeInput.value = '';
        });

        function displayReminders() {
            const reminderList = document.getElementById('reminder-list');
            reminderList.innerHTML = '';

            calendar.reminders.forEach((reminder) => {
                reminder.startReminderTimer();
                const row = document.createElement('tr');
                const dateCell = document.createElement('td');
                const timeCell = document.createElement('td');
                const eventCell = document.createElement('td');
                const actionsCell = document.createElement('td');
                const deleteButton = document.createElement('button');

                dateCell.textContent = reminder.getDate();
                timeCell.textContent = reminder.getTime();
                eventCell.textContent = reminder.getEvent();
                deleteButton.textContent = 'Delete';

                deleteButton.addEventListener('click', () => {
                    calendar.removeReminder(reminder);
                    displayReminders();
                });

                row.appendChild(dateCell);
                row.appendChild(timeCell);
                row.appendChild(eventCell);
                actionsCell.appendChild(deleteButton);
                row.appendChild(actionsCell);
                reminderList.appendChild(row);
            });
        }

        displayReminders();
        // ... (Your existing JavaScript code)

        generateCalendar(calendar.currentYear, calendar.currentMonth);

    </script>
</body>

</html>